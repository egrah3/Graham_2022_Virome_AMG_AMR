---
title: "ovrall"
output: html_document
---

```{r}
library(NRES803)
library(tidyverse)
library(GGally)
library(readr)
library(mgcv)
library(broom)
library(gridExtra)
library(lme4)
library(lmerTest)
library(broom.mixed)
library(readr)
library(phyloseq)
library(dplyr)
library(tidyr)
library(ggplot2)
library(phyloseq)
library(tidyverse)
library(microbiome)
library(readr)
library("ggpubr")
library("tidyverse")
library(vegan)
library(ComplexHeatmap)
library(gridBase)
library(metagenomeSeq)
library(bbmle)
library(glmmTMB)
```

```{r}
counts <- read_delim("counts2.txt", "\t", escape_double = FALSE, trim_ws = TRUE)
bins <- read_csv("bins.csv")
```
```{r}
HCONTIGS_rm <- c("k127_11632694","k127_12517205","k127_2798721", "k127_5380197", "k127_1709016", "k127_2340136", "k127_11067739", "k127_14672795", "k127_10480125", "k127_2851424", "k127_5134984", "k127_1039230", "k127_4198160", "k127_10981547", "k127_1701658", "k127_5175638", "k127_9194239", "k127_1787333", "k127_3451572", "k127_9585263", "k127_218144", "k127_9842593", "k127_1350710", "k127_4261732", "k127_5570886", "k127_7722490", "k127_7961006", "k127_1558984", "k127_611454", "k127_10064636", "k127_12174067", "k127_5559691", "k127_13647452", "k127_1938641", "k127_5568742", "k127_12623331", "k127_2228337", "k127_4510796", "k127_6398189", "k127_6557954", "k127_10561040", "k127_1736030", "k127_274874", "k127_1892901", "k127_5139952","k127_1592671", "k127_225219", "k127_10043076", "k127_7822328", "k127_15111770", "k127_15132484", "k127_6071879", "k127_705325", "k127_9456305", "k127_13667496", "k127_7094692", "k127_10140600", "k127_4283108", "k127_1260992", "k127_14469806", "k127_13661983", "k127_1192119", "k127_3976383","k127_1290084", "k127_6280615", "k127_4386373", "k127_5862475", "k127_9823920", "k127_6034156", "k127_2685241", "k127_13301266", "k127_7931824", "k127_11968426", "k127_3274825", "k127_7914723", "k127_3540161", "k127_13033176", "k127_239394", "k127_9097870", "k127_10864628", "k127_1966963", "k127_2345368", "k127_7143733", "k127_2896667", "k127_1743851", "k127_12202550", "k127_5527506", "k127_9104195", "k127_10143219", "k127_2064371", "k127_1693421", "k127_2924268", "k127_5623316", "k127_6822225", "k127_7477585", "k127_4633305", "k127_9323619", "k127_6011142", "k127_15115933", "k127_13364738", "k127_1731407", "k127_6591431", "k127_1104077", "k127_2775415", "k127_7007437", "k127_13840674", "k127_5136074", "k127_11233316", "k127_9928395", "k127_4345839", "k127_72136", "k127_8110186", "k127_839618", "k127_47647", "k127_325005", "k127_5889953", "k127_15155057", "k127_2435081", "k127_1525866", "k127_2662332", "k127_691068", "k127_35155", "k127_5667047", "k127_3870678", "k127_4520286", "k127_5287877", "k127_5483372", "k127_11739458", "k127_4866236", "k127_1365983", "k127_6589275", "k127_2946872", "k127_4464878", "k127_5322281", "k127_884451", "k127_12017435", "k127_12036797", "k127_556632", "k127_9065548", "k127_12900110", "k127_14078954", "k127_2112847", "k127_9046034", "k127_12428841", "k127_2979919", "k127_3444322", "k127_967472","k127_2127691", "k127_5235872", "k127_7205518", "k127_827607", "k127_13418353", "k127_13052610", "k127_13052610", "k127_5592647", "k127_9056342", "k127_5565440", "k127_9368858", "k127_13819491", "k127_7169758", "k127_8318224", "k127_2100483", "k127_2891612", "k127_3867246", "k127_10351201", "k127_15106482", "k127_4553", "k127_7916464", "k127_1811691", "k127_6791562", "k127_1577532", "k127_1605082", "k127_5456666", "k127_13833324", "k127_894654", "k127_9372791", "k127_3411100", "k127_13196142", "k127_2463140", "k127_2222331", "k127_8286280", "k127_5837650", "k127_12726797", "k127_3522404", "k127_4422966", "k127_5197662", "k127_7899678" , "k127_13616033", "k127_3581367", "k127_7860574", "k127_8221994", "k127_8424639", "k127_9691319", "k127_8607497", "k127_13288907", "k127_2110168", "k127_2805627", "k127_3667659", "k127_11842373", "k127_13586400", "k127_5185287", "k127_11398990", "k127_7614312", "k127_2327410", "k127_3160663", "k127_6228812", "k127_15129560", "k127_4412167", "k127_5450845", "k127_7571654", "k127_955489", "k127_9835800", "k127_1968911", "k127_3566283", "k127_6369763", "k127_3551838", "k127_5330898", "k127_7307095", "k127_7692976", "k127_8454235", "k127_9005323", "k127_10830472", "k127_3403932", "k127_693464", "k127_11500670", "k127_1169623", "k127_15156715", "k127_8877823", "k127_15189454", "k127_3117913", "k127_5709665", "k127_6828961", "k127_12414093", "k127_13627891", "k127_7101677", "k127_72581", "k127_9216021", "k127_3421421", "k127_8129751", "k127_995733", "k127_15099745", "k127_3004871", "k127_7884232", "k127_7975612", "k127_7979869", "k127_8111155", "k127_15100358", "k127_1581352", "k127_5332028", "k127_9117737", "k127_9896843", "k127_7675399", "k127_14768517", "k127_2294331", "k127_11645423", "k127_5184613", "k127_10068001", "k127_257311", "k127_257311", "k127_1371212", "k127_4745164", "k127_11003516", "k127_4112678", "k127_12557310", "k127_2424981", "k127_6085477", "k127_5154234", "k127_2170239", "k127_15148971", "k127_4800687", "k127_13455192", "k127_3213071", "k127_8792540", "k127_3113985", "k127_8206000", "k127_7178676", "k127_11227869", "k127_12214912", "k127_12892257", "k127_13382384", "k127_3705225", "k127_953012", "k127_1949954", "k127_6402537", "k127_7142848", "k127_2761585", "k127_12513183", "k127_12868982", "k127_3772368", "k127_9408825", "k127_12745529", "k127_5662408", "k127_11836120", "k127_1028709", "k127_12312342", "k127_5497610", "k127_5710441", "k127_8729675", "k127_9248632", "k127_10230574", "k127_4263265", "k127_8657517", "k127_9115221", "k127_3435001", "k127_3473080", "k127_5110169", "k127_194936", "k127_244589", "k127_2586448", "k127_2109170", "k127_9279204", "k127_4137292", "k127_10762530", "k127_209546", "k127_2689643", "k127_6372496", "k127_6751850", "k127_9151293", "k127_5924583", "k127_5492630", "k127_5759236", "k127_4094686", "k127_1117809", "k127_1285358", "k127_8526113", "k127_2588032", "k127_1140542", "k127_3788563", "k127_15120480", "k127_11970428", "k127_3400891", "k127_3104562", "k127_13680206", "k127_353225", "k127_4190931", "k127_789091", "k127_2845430", "k127_946342", "k127_10283706", "k127_13333317", "k127_11408975", "k127_1695561", "k127_2065326", "k127_5995761", "k127_8306285", "k127_15098674", "k127_5565293", "k127_13015367", "k127_36553", "k127_29177", "k127_4425599", "k127_6807272", "k127_1278113", "k127_13668104", "k127_3440604", "k127_463979", "k127_6307460", "k127_999034", "k127_1388475", "k127_700394", "k127_860294", "k127_1808506", "k127_14917902", "k127_14240615", "k127_13224940", "k127_4171209", "k127_2958485", "k127_11278545", "k127_10556097", "k127_86542", "k127_11167768", "k127_14531205", "k127_13065274", "k127_9359472", "k127_4155167", "k127_7041993", "k127_12101888", "k127_3857584", "k127_13910601", "k127_12422489", "k127_1354050", "k127_1474150", "k127_1795125", "k127_2988621", "k127_3044500", "k127_4290284", "k127_9909907", "k127_4522130", "k127_8370407", "k127_11781602", "k127_7747721", "k127_2562660", "k127_3871211", "k127_6621283", "k127_14299888", "k127_3999318", "k127_793132", "k127_10739798", "k127_13073532", "k127_13837981", "k127_11426238", "k127_11650959", "k127_2802422", "k127_3655598", "k127_9778866", "k127_11892500", "k127_7429941", "k127_460434", "k127_3429332", "k127_8931653", "k127_11186609", "k127_11574657", "k127_620932", "k127_814637", "k127_8788655", "k127_11181367", "k127_1314458", "k127_2324253", "k127_3398786", "k127_14107142", "k127_8750766", "k127_9752645", "k127_5101988", "k127_11482604", "k127_12276522", "k127_2154937", "k127_15097785", "k127_9957591", "k127_12102314", "k127_13781306", "k127_7511981", "k127_3224450", "k127_10787476", "k127_434377", "k127_9026036", "k127_11804567", "k127_12073101", "k127_13284009", "k127_8151729", "k127_2405037", "k127_5058031", "k127_7769287", "k127_11406330", "k127_10491149", "k127_1237762", "k127_8686882", "k127_1536896", "k127_4202066", "k127_15099235",                )

BCONTIGS_rm <- c("k127_758793", "k127_2971724", "k127_1428496", "k127_8352561", "k127_12614382", "k127_2601876", "k127_14195907", "k127_10699727", "k127_4242004", "k127_143003", "k127_5597206", "k127_11937381", "k127_1178636", "k127_4714281", "k127_6369208", "k127_7749273", "k127_11732019", "k127_12152770", "k127_14050397", "k127_6135413", "k127_5238348", "k127_13581863", "k127_3518650", "k127_12822846", "k127_13960680", "k127_1326468", "k127_13243558", "k127_13742160", "k127_4168683", "k127_12189606", "k127_1772803", "k127_13947841", "k127_7490746", "k127_13629978", "k127_5644775", "k127_3031474", "k127_2199767", "k127_11780841", "k127_558837", "k127_662245", "k127_1478200", "k127_12720809", "k127_15136106", "k127_561856"    )
#remove determined via Ema 
#bin001 remove (human/animal)
"k127_11632694","k127_12517205","k127_2798721", "k127_5380197", "k127_1709016", "k127_2340136", "k127_11067739", "k127_14672795", "k127_10480125", "k127_2851424", "k127_5134984", "k127_1039230", "k127_4198160", "k127_10981547", "k127_1701658", "k127_5175638", "k127_9194239", "k127_1787333", "k127_3451572", "k127_9585263", "k127_218144", "k127_9842593", "k127_1350710", "k127_4261732", "k127_5570886", "k127_7722490", "k127_7961006", "k127_1558984", "k127_611454", "k127_10064636", "k127_12174067", "k127_5559691", "k127_13647452", "k127_1938641", "k127_5568742", "k127_12623331", "k127_2228337", "k127_4510796", "k127_6398189", "k127_6557954", "k127_10561040", "k127_1736030", "k127_274874", "k127_1892901", "k127_5139952"
  #bacteria


#bin003 remove (mix; keep bacterial and plant)
"k127_1592671", "k127_225219", "k127_10043076", "k127_7822328", "k127_15111770", "k127_15132484", "k127_6071879", "k127_705325", "k127_9456305", "k127_13667496", "k127_7094692", "k127_10140600", "k127_4283108", "k127_1260992", "k127_14469806", "k127_13661983", "k127_1192119", "k127_3976383"
#bin005 remove (keep)
  #none; all have low %query coverage
#bin006 remove (Animal(cat/dog)) (remove bin!!!!!)
"k127_1290084", "k127_6280615"
#bin007 (bacteria; possible lab contamination)
"k127_4386373", "k127_5862475", "k127_9823920", "k127_6034156", "k127_2685241", "k127_13301266", "k127_7931824", "k127_11968426", "k127_3274825", "k127_7914723", "k127_3540161", "k127_13033176", "k127_239394", "k127_9097870", "k127_10864628"
#bin008 (bacteria)
  #none but potential fusobacterium contamination
#bin009 (bacteria)
  #none potential lactobacillus contamination
#bin010 (human/animal; no viral genes detected' remove bin!!!)
"k127_1966963", "k127_2345368", "k127_7143733", "k127_2896667", "k127_1743851", "k127_12202550", "k127_5527506", "k127_9104195", "k127_10143219", "k127_2064371", "k127_1693421", "k127_2924268", "k127_5623316", "k127_6822225", "k127_7477585", "k127_4633305", "k127_9323619", "k127_6011142", "k127_15115933"
#bin011 (bacteria; contains one fusbacterium contig)
  #none
#bin012 (bacteria; some fusobacteria contamination)
"k127_13364738", "k127_1731407", "k127_6591431"
#bin013 (bacteria and human)
  #none
#bin014
"k127_1104077"
#bin015 (bacteria, contains fuso and lacto)
"k127_2775415", "k127_7007437", "k127_13840674", "k127_5136074", "k127_11233316", "k127_9928395", "k127_4345839", "k127_72136"
#bin016 (Animal and Human)
"k127_8110186", "k127_839618", "k127_47647", "k127_325005", "k127_5889953", "k127_15155057"
#bin017
"k127_2435081"
#bin018 (mostly all human except for 2 staph contigs)
"k127_1525866", "k127_2662332", "k127_691068", "k127_35155", "k127_5667047", "k127_3870678", "k127_4520286", "k127_5287877", "k127_5483372", "k127_11739458", "k127_4866236", "k127_1365983", "k127_6589275", "k127_2946872", "k127_4464878", "k127_5322281", "k127_884451", "k127_12017435", "k127_12036797", "k127_556632", "k127_9065548", "k127_12900110", "k127_14078954", "k127_2112847", "k127_9046034", "k127_12428841", "k127_2979919", "k127_3444322", "k127_967472","k127_2127691", "k127_5235872", "k127_7205518", "k127_827607", "k127_13418353", "k127_13052610", "k127_13052610", "k127_5592647", "k127_9056342", "k127_5565440", "k127_9368858", "k127_13819491", "k127_7169758"
#bin019
  #none
#bin021
  #none
#bin022
"k127_8318224", "k127_2100483"
#bin023
"k127_2891612"
#bin024
"k127_3867246", "k127_10351201", "k127_15106482", "k127_4553"
#bin025 (human/animal)
"k127_7916464", "k127_1811691", "k127_6791562", "k127_1577532", "k127_1605082", "k127_5456666", "k127_13833324", 
#bin027
"k127_894654", "k127_9372791", "k127_3411100"
#bin029 (human)
"k127_13196142", "k127_2463140", "k127_2222331", "k127_8286280", "k127_5837650", "k127_12726797", "k127_3522404", "k127_4422966", "k127_5197662", "k127_7899678" , "k127_13616033", "k127_3581367", "k127_7860574", "k127_8221994", "k127_8424639", "k127_9691319", "k127_8607497", "k127_13288907", "k127_2110168", "k127_2805627", "k127_3667659", "k127_11842373", "k127_13586400", "k127_5185287", "k127_11398990", "k127_7614312", "k127_2327410", "k127_3160663", "k127_6228812", "k127_15129560", "k127_4412167", "k127_5450845", "k127_7571654", "k127_955489", "k127_9835800", "k127_1968911", "k127_3566283", "k127_6369763", "k127_3551838", "k127_5330898", "k127_7307095", "k127_7692976", "k127_8454235", "k127_9005323", "k127_10830472", "k127_3403932", "k127_693464", "k127_11500670", "k127_1169623", "k127_15156715", "k127_8877823", "k127_15189454", "k127_3117913", "k127_5709665", "k127_6828961", "k127_12414093", "k127_13627891", "k127_7101677", "k127_72581", "k127_9216021", "k127_3421421", "k127_8129751", "k127_995733", "k127_15099745", "k127_3004871", "k127_7884232", "k127_7975612", "k127_7979869", "k127_8111155", "k127_15100358", "k127_1581352", "k127_5332028", "k127_9117737", "k127_9896843"
#bin030
  #none, no eukaryotic hits. A lot of staph hits though 
#bin031
"k127_7675399"
#bin032
"k127_14768517"
#bin033
"k127_2294331"
#bin037
"k127_11645423", "k127_5184613", "k127_10068001", "k127_257311", "k127_257311", "k127_1371212", "k127_4745164", "k127_11003516", "k127_4112678", "k127_12557310", "k127_2424981", "k127_6085477", "k127_5154234", "k127_2170239", "k127_15148971", "k127_4800687", "k127_13455192", "k127_3213071", "k127_8792540", "k127_3113985", "k127_8206000", "k127_7178676"
#bin038
  #none
#bin039 (bacteria)
  #none
#bin040
"k127_11227869", "k127_12214912", "k127_12892257", "k127_13382384", "k127_3705225", "k127_953012", "k127_1949954", "k127_6402537", "k127_7142848", "k127_2761585", "k127_12513183", "k127_12868982", "k127_3772368", "k127_9408825", "k127_12745529", "k127_5662408", "k127_11836120", "k127_1028709", "k127_12312342", "k127_5497610", "k127_5710441", "k127_8729675", "k127_9248632", "k127_10230574", "k127_4263265", "k127_8657517", "k127_9115221", "k127_3435001", "k127_3473080", "k127_5110169", "k127_194936", "k127_244589", "k127_2586448", "k127_2109170", "k127_9279204", "k127_4137292" 
#bin041
"k127_10762530", "k127_209546", "k127_2689643", "k127_6372496", "k127_6751850", "k127_9151293", "k127_5924583", "k127_5492630", "k127_5759236", "k127_4094686", "k127_1117809", "k127_1285358", "k127_8526113", "k127_2588032", "k127_1140542", "k127_3788563", "k127_15120480", "k127_11970428", "k127_3400891", "k127_3104562"
#bin042
"k127_13680206", "k127_353225", "k127_4190931", "k127_789091", "k127_2845430", "k127_946342", "k127_10283706", "k127_13333317", "k127_11408975", "k127_1695561", "k127_2065326", "k127_5995761", "k127_8306285", "k127_15098674", "k127_5565293"
#bin044
"k127_13015367", "k127_36553", "k127_29177", "k127_4425599"
#bin045
"k127_6807272"
#bin046
"k127_1278113", "k127_13668104", "k127_3440604", "k127_463979", "k127_6307460", "k127_999034", "k127_1388475", "k127_700394", "k127_860294"

#bin048
"k127_1808506", "k127_14917902", "k127_14240615", "k127_13224940", "k127_4171209", "k127_2958485", "k127_11278545"
  #bacteria
"k127_758793", "k127_2971724", "k127_1428496", "k127_8352561"

#bin051
"k127_10556097",
  #bacteria
"k127_12614382", "k127_2601876"

#bin052
"k127_86542", "k127_11167768", "k127_14531205", 
  #bacteria
"k127_14195907", "k127_10699727", "k127_4242004", "k127_143003", "k127_5597206", "k127_11937381", "k127_1178636"

#bin054
"k127_13065274", "k127_9359472", "k127_4155167", "k127_7041993", "k127_12101888", "k127_3857584", "k127_13910601"
  #bacteria
"k127_4714281", "k127_6369208", "k127_7749273", "k127_11732019", "k127_12152770", "k127_14050397", "k127_6135413", "k127_5238348", "k127_13581863", "k127_3518650", "k127_12822846", "k127_13960680", "k127_1326468"

#bin055 (fungus and plants)
"k127_12422489", "k127_1354050", "k127_1474150", "k127_1795125", "k127_2988621", "k127_3044500", "k127_4290284", "k127_9909907", "k127_4522130", "k127_8370407", "k127_11781602", "k127_7747721", "k127_2562660", "k127_3871211", "k127_6621283", "k127_14299888", "k127_3999318", "k127_793132", "k127_10739798", "k127_13073532", "k127_13837981", "k127_11426238", "k127_11650959", "k127_2802422", "k127_3655598", "k127_9778866", "k127_11892500", "k127_7429941", "k127_460434", "k127_3429332", "k127_8931653", "k127_11186609", "k127_11574657", "k127_620932", "k127_814637", "k127_8788655"
  #bacteria
"k127_13243558", "k127_13742160", "k127_4168683", "k127_12189606", "k127_1772803", "k127_13947841", "k127_7490746", "k127_13629978", "k127_5644775", "k127_3031474", "k127_2199767", "k127_11780841", "k127_558837", "k127_662245", "k127_1478200", "k127_12720809", "k127_15136106"

#bin056
"k127_11181367", "k127_1314458", "k127_2324253", "k127_3398786", "k127_14107142", "k127_8750766", "k127_9752645", "k127_5101988", "k127_11482604", "k127_12276522", "k127_2154937", "k127_15097785", "k127_9957591", "k127_12102314", "k127_13781306", "k127_7511981", "k127_3224450", "k127_10787476", "k127_434377", "k127_9026036", "k127_11804567", "k127_12073101", "k127_13284009", "k127_8151729", "k127_2405037", "k127_5058031", "k127_7769287"
  #bacteria
"k127_561856"

#bin057
"k127_11406330", "k127_10491149", "k127_1237762", "k127_8686882", "k127_1536896", "k127_4202066", "k127_15099235"
 


```

```{r}
bins$contig <- gsub(">k", "k", bins$contig)
bins$phylum <- bins$contig
bins3 <- subset(bins, select = c(Bin))
bins3 <- bins3[!duplicated(bins3), ]
bins3$genus <- bins3$Bin


write_csv(bins3, 'Anntations.csv')
PTAX_pre <- read.csv("Anntations.csv", quote = "", header = TRUE, stringsAsFactors = FALSE, row.names = 1)
PTAX_pre$Bin <- row.names(PTAX_pre)
PTAX_pre<- as.matrix(PTAX_pre)
PTAX <- tax_table(PTAX_pre)

counts2 <- subset(counts, select = -c(length))
bintest<- merge(counts2,bins, by= "contig")
bintest <- subset(bintest, select = -c(phylum))
bintest2<-bintest %>%
  group_by(Bin) %>%
  summarise_if(
    is.numeric,
    sum)
write_csv(bintest2, 'counts.csv')
OTU_counts <- read.csv("counts.csv", quote = "", header = TRUE, stringsAsFactors = FALSE, row.names = 1)


POTU <- otu_table(OTU_counts, taxa_are_rows = TRUE)
Metadata2 <- read_csv("~/Desktop/Current_work/OTU_Builber/Sequencing_Data_Info_Sheet3.csv")
Metadata3 <- Metadata2
Metadata3$Time <- Metadata3$Time_Collected



Metadata3$Time[which(Metadata3$Time == "T_0")] <- "00_Weeks"
Metadata3$Time[which(Metadata3$Time == "2_week")] <- "02_Weeks"
Metadata3$Time[which(Metadata3$Time == "1_month")] <- "04_Weeks"
Metadata3$Time[which(Metadata3$Time == "3_month")] <- "12_Weeks"
Metadata3$Time[which(Metadata3$Time == "6_month")] <- "24_Weeks"

META <- sample_data(Metadata3)
sample_names(META)= META$SampleID
PHY <- phyloseq(POTU, PTAX, META)
```
```{r}
Samples_toRemove <- c("HV_001_27", "HV_002_27", "HV_003_27", "HV_004_27", "HV_005_27", "HV_006_27", "HV_007_27", "HV_008_27",
                      "HV_009_27", "HV_010_27", "HV_011_27", "HV_012_27", "HV_013_27", "HV_014_27", "HV_015_27", "HV_016_27",
                      "HV_017_27", "HV_018_27", "HV_019_27", "HV_020_27", "HV_021_27", "HV_022_27", "HV_023_27", "HV_024_27",
                      "HV_025_27", "HV_026_27", "HV_027_27", "HV_028_27", "HV_029_27", "HV_030_27", "HV_015_20", "HV_015_21", 
                      "HV_020_22", "HV_027_02", "HV_027_03", "HV_027_04", "HV_027_05", "HV_027_06", "HV_027_07", "HV_020_10",
                      "HV_021_13", "HV_027_01")
PHY1 <- subset_samples(PHY, !(SampleID %in% Samples_toRemove))
```

```{r}
Bins_toRemove <- c("b123", "b128", "b141", "b153", "b163", "b000", "b198", "b208", "b028", "b035", "b049", "b074", "b084", "b109", "b124", "b138", "b149", "b154", "b166", "b199", "b026", "b002", "b036", "b058", "b082", "b093", "b101", "b102", "b115", "b117", "b132", "b139", "b159", "b177", "b207", "b020", "b034", "b043", "b004", "b050", "b053", "b064", "b075", "b075", "b083", "b085")
PHY2<- subset_taxa(PHY1, !(Bin %in% Bins_toRemove) )
```

```{r}
Human_toRemove <- c("k127_4726388", "k127_8149250","k127_5179579","k127_10852920","k127_2647","k127_7704155","k127_12409878","k127_7705279","k127_5897","k127_1291352","k127_9854925","k127_4725986","k127_8578082","k127_11584990","k127_6024987","k127_2176684","k127_5603538","k127_11605110","k127_1750188","k127_5608660","k127_6463225","k127_2187792","k127_15041988","k127_15042814","k127_41205","k127_906233","k127_6471977","k127_47429","k127_2199394","k127_8197394","k127_14637921","k127_5632121","k127_11216291","k127_5215310","k127_6073437","k127_3076121","k127_5647099","k127_3520396","k127_11233469","k127_15099609","k127_15099831","k127_15099942","k127_15100136","k127_15100162","k127_15100360","k127_15100462","k127_2662580","k127_15101358","k127_7383274","k127_15102006","k127_15102452","k127_15102544","k127_15103188","k127_15103450","k127_7389096","k127_15104090","k127_15104094","k127_15104348","k127_15104348","k127_2247091","k127_15106103","k127_2675765","k127_15106579","k127_15106786","k127_15107730","k127_15108021","k127_8260401","k127_15110753","k127_15111324","k127_14720053","k127_15111864","k127_2268972","k127_15114101","k127_15115236","k127_15116196","k127_15116824","k127_15116950","k127_15117075","k127_15117214","k127_15117417","k127_15118253","k127_558857","k127_15119079","k127_15119091","k127_15119273","k127_15119447","k127_8717700","k127_15120990","k127_15121314","k127_15121883","k127_15123251","k127_15123358","k127_15124100","k127_10890110","k127_11316133","k127_140797","k127_15128543","k127_1012153","k127_15129855","k127_148682","k127_1018283","k127_9175727","k127_15133804","k127_13915595","k127_15135385","k127_15137666","k127_1032585","k127_3632439","k127_15138948","k127_15139760","k127_15139789","k127_14389020","k127_15140818","k127_5342483","k127_4081218","k127_4930750","k127_15147417","k127_15147777","k127_15148668","k127_10097618","k127_15150569","k127_8805097","k127_3225237","k127_15157443","k127_9687695","k127_4120085","k127_15159669","k127_15160254","k127_13121994","k127_15162311","k127_8414707","k127_15164150","k127_15164274","k127_13144400","k127_15170388","k127_15170671","k127_15170958","k127_15172276","k127_5419238","k127_15176791","k127_15176872","k127_15178420","k127_15178530","k127_15178773","k127_15179628","k127_15180711","k127_15182767","k127_15184026","k127_13188510","k127_10203919","k127_5030223","k127_15187784","k127_11925247","k127_9767440","k127_12340505","k127_13634591","k127_13639111","k127_11494411","k127_5898508","k127_7638094","k127_11091857","k127_13218961","k127_11095330","k127_2469890","k127_9345399","k127_13228705","k127_11958937","k127_8517654","k127_13666632","k127_11522576","k127_9806724","k127_7663378","k127_7251726","k127_12801584","k127_15208396","k127_7669462","k127_15209221","k127_326401","k127_6357911","k127_12398329","k127_5510177","k127_5510875","k127_9385411","k127_5514121","k127_5517317","k127_6381166","k127_15223664","k127_5527970","k127_2961181","k127_3412740","k127_2966998","k127_2113247","k127_2115891","k127_15238446","k127_15239050","k127_1282219","k127_8172083","k127_13913675","k127_187894","k127_3839154","k127_2138768","k127_8982817","k127_2139191","k127_7700602","k127_428875","k127_12406403","k127_14546302","k127_5990360","k127_13690811","k127_1286291","k127_10269702","k127_11980218","k127_2569702","k127_4708710","k127_1287076","k127_431467","k127_1288113","k127_5565409","k127_8988427","k127_8988608","k127_860542","k127_1716052","k127_1716739","k127_1289741","k127_9419498","k127_5995272","k127_9420574","k127_13269207","k127_9421734","k127_11560506","k127_10278031","k127_1293401","k127_14986712","k127_13700211","k127_14987314","k127_3862788","k127_13700756","k127_1294473","k127_7286565","k127_2150348","k127_6427718","k127_13701522","k127_5572130","k127_7287435","k127_13273245","k127_2151202","k127_13273462","k127_4292527","k127_8141360")
                    
Human_toRemove2<- c("k127_6001996","k127_13275181","k127_4721033","k127_10284078","k127_14992458","k127_8142896","k127_9855635","k127_4721981","k127_5149369","k127_8999582","k127_11996183","k127_11143254","k127_13587","k127_872703","k127_11997879","k127_7719222","k127_8576196","k127_12424291","k127_12853427","k127_2157703","k127_2585216","k127_9860769","k127_3443230","k127_4300493","k127_446110","k127_6008323","k127_446891","k127_14143811","k127_16663","k127_8579181","k127_5155610","k127_9863776","k127_447859","k127_12857833","k127_2588255","k127_4304055","k127_877962","k127_9865309","k127_10295122","k127_7725743","k127_6011723","k127_6440159","k127_12430940","k127_13288337","k127_12431621","k127_20632","k127_881500","k127_2592458","k127_8586336","k127_6015792","k127_453792","k127_3021637","k127_23678","k127_3022137","k127_4738504","k127_885656","k127_5591535","k127_1315653","k127_7309831","k127_1316561","k127_2597079","k127_11162487","k127_3025290","k127_12017782","k127_458634","k127_5167985","k127_3890778","k127_10737526","k127_5169055","k127_3027410","k127_4744579","k127_1743349","k127_11595623","k127_3462963","k127_2176764","k127_3893754","k127_462042","k127_7317064","k127_6453665","k127_5600450","k127_1323953","k127_12448622","k127_12026297","k127_1747547","k127_4327048","k127_8173615","k127_13741319","k127_9889522","k127_9029458","k127_4752845","k127_12029580","k127_36540","k127_5178503","k127_7749933","k127_8176637","k127_11607162","k127_7325932","k127_14179413","k127_12031497","k127_3903251","k127_37820","k127_3903426","k127_9468147","k127_10323982","k127_11179699","k127_9893543","k127_9033861","k127_9034137","k127_10755089","k127_2188358","k127_15041677","k127_40423","k127_6037448","k127_3476382","k127_7755313","k127_8610260","k127_10756355","k127_12036208","k127_2189682","k127_5184081","k127_2615009","k127_6466883","k127_11185280","k127_904554","k127_474075","k127_3909478","k127_11615542","k127_2192258","k127_7760262","k127_1338554","k127_5616226","k127_13754931","k127_3912894","k127_13755897","k127_3483275","k127_4343909","k127_5617173","k127_11191580","k127_5618113","k127_478942","k127_479019","k127_3047606","k127_12898267","k127_5618837","k127_8190097","k127_11192655","k127_13327097","k127_910599","k127_479928","k127_6473642","k127_47006","k127_910992","k127_911284","k127_9046539","k127_481439","k127_3050672","k127_1344900","k127_9484408","k127_913684","k127_2625268","k127_10769552","k127_1765778","k127_10345168","k127_7771043","k127_9051631","k127_3492937","k127_9488280","k127_2203819","k127_13335670","k127_2628860","k127_11630644","k127_7774383","k127_6481697","k127_4355176","k127_10775875","k127_4777213","k127_487719","k127_12478927","k127_3927309","k127_919773","k127_7350120","k127_11633668","k127_12056560","k127_6484696","k127_13773139","k127_3929771","k127_12912531","k127_8632314","k127_6059428","k127_9494903","k127_8204019","k127_12913688","k127_922861","k127_3061427","k127_11208641","k127_9920545","k127_11208661","k127_8204835","k127_12914439","k127_3062738","k127_3932960","k127_14215166","k127_10783708","k127_2212318","k127_6931245","k127_925890","k127_1357671","k127_926064","k127_4785501","k127_3508018","k127_62918","k127_7787099","k127_496797","k127_5638746","k127_3938897","k127_7788412","k127_12922108","k127_4788729","k127_4788740","k127_2643238","k127_3510775","k127_12924454")

Human_toRemove3<- c("k127_7790896","k127_13354341","k127_66211","k127_7792114","k127_3073210","k127_6072316","k127_7365806","k127_9935101","k127_2647964","k127_3515502","k127_11222381","k127_6073355","k127_12075051","k127_2221817","k127_10373785","k127_10374298","k127_1788076","k127_11224968","k127_6945041","k127_9512218","k127_5221332","k127_71913","k127_7799952","k127_4800338","k127_5651610","k127_15098512","k127_15098564","k127_12082791","k127_15098712","k127_12503208","k127_3082515","k127_75012","k127_5226092","k127_1375232","k127_942960","k127_512124","k127_943209","k127_12506319","k127_5656132","k127_512745","k127_9084036","k127_1376859","k127_5656618","k127_3957157","k127_11665030","k127_3085247","k127_10810699","k127_12940704","k127_3085643","k127_8659674","k127_15100347","k127_13807096","k127_15100431","k127_5658223","k127_2661048","k127_11666778","k127_9086332","k127_6957182","k127_9086647","k127_6517612","k127_15100802","k127_9087436","k127_1799729","k127_5660552","k127_12091657","k127_15101499","k127_4392486","k127_15101648","k127_1382325","k127_15101743","k127_15101768","k127_12093476","k127_3533238","k127_9956553","k127_11241948","k127_9090872","k127_3533984","k127_4394179","k127_7813264","k127_15102282","k127_15102296","k127_520373","k127_13814525","k127_4395322","k127_521280","k127_6092337","k127_6523882","k127_9530895","k127_8241067","k127_15102971","k127_15103088","k127_15103156","k127_2240432","k127_5238188","k127_7817257","k127_953676","k127_14257965","k127_11247148","k127_85717","k127_3968636","k127_15103771","k127_2241666","k127_5240095","k127_12100223","k127_6096747","k127_15104370","k127_4818593","k127_7392698","k127_4818855","k127_3971385","k127_14262086","k127_12521968","k127_4402641","k127_3097888","k127_13822734","k127_12523346","k127_9099273","k127_10404697","k127_8675563","k127_90304","k127_6974380","k127_11254247","k127_959237","k127_11685118","k127_3100742","k127_8677491","k127_92324","k127_14702589","k127_15106847","k127_4824599","k127_9104151","k127_9543126","k127_531663","k127_1397637","k127_3547663","k127_7400434","k127_6104746","k127_12961234","k127_3979001","k127_7828382","k127_3548102","k127_12109742","k127_6979182","k127_10412057","k127_13395409","k127_7401633","k127_5678992","k127_8681683","k127_11691795","k127_535004","k127_11692508","k127_96840","k127_6542510","k127_3983002","k127_98354","k127_14279118","k127_8261626","k127_8261887","k127_5684326","k127_10419126","k127_12536565","k127_4416546","k127_2685257","k127_8687357","k127_15110492","k127_13403377","k127_15110769","k127_13839974","k127_6547576","k127_5687121","k127_101846","k127_8689142","k127_15110949","k127_1824892","k127_12971547","k127_6989642","k127_1825182","k127_8690397","k127_6116089","k127_7841175","k127_15111812","k127_8269908","k127_13408747","k127_15112301","k127_2691772","k127_8270872","k127_15112600","k127_2692249","k127_544770","k127_1412654","k127_15112868","k127_2265856","k127_107176","k127_15113042","k127_5694914","k127_1413674","k127_9121807","k127_12127867","k127_976213","k127_15113788","k127_5267837","k127_1415522","k127_12549440","k127_13414089","k127_6122693","k127_2269221","k127_13851633","k127_1417385","k127_12131623","k127_4845294","k127_7421730","k127_12552153","k127_15115421")

Human_toRemove4<- c("k127_9995642","k127_13854428","k127_1836503","k127_112863","k127_3126920","k127_3127356","k127_5273122","k127_3570579","k127_4849137","k127_3572016","k127_14737428","k127_4435948","k127_12557539","k127_14306111","k127_8284432","k127_10863939","k127_6566989","k127_556511","k127_3574244","k127_4852842","k127_10865210","k127_2279142","k127_2279278","k127_15118187","k127_7860232","k127_5280221","k127_13426390","k127_10871207","k127_6136218","k127_2709538","k127_2709767","k127_4013874","k127_990072","k127_4014665","k127_12998872","k127_6576927","k127_8717842","k127_13871763","k127_12150448","k127_1850527","k127_9143378","k127_3584548","k127_994192","k127_11732974","k127_10877995","k127_4018826","k127_7440870","k127_3142677","k127_14754125","k127_10015695","k127_1852575","k127_2289444","k127_11305260","k127_568006","k127_3143990","k127_5720059","k127_15122284","k127_568933","k127_8723435","k127_3146033","k127_131797","k127_9150757","k127_999479","k127_2293794","k127_3148196","k127_7029787","k127_573359","k127_6587927","k127_12160826","k127_11312888","k127_14763193","k127_12161718","k127_7879114","k127_9154574","k127_10026275","k127_4874187","k127_4874812","k127_7880407","k127_3152239","k127_6591742","k127_15125803","k127_1862113","k127_7452931","k127_13887974","k127_578566","k127_139310","k127_1863454","k127_5731347","k127_5731609","k127_9159536","k127_11319222","k127_6157426","k127_11750739","k127_10894566","k127_7885927","k127_7039046","k127_7456573","k127_7887023","k127_1010041","k127_4467275","k127_1010754","k127_6598882","k127_7459182","k127_15128662","k127_12590614","k127_9164974","k127_7890312","k127_13025720","k127_8318679","k127_3160539","k127_1869690","k127_4040380","k127_1453706","k127_13457882","k127_10901665","k127_1871573","k127_1871712","k127_2309712","k127_11327719","k127_14779182","k127_9168396","k127_8322244","k127_6604177","k127_9168768","k127_4043882","k127_7894712","k127_9169595","k127_5742330","k127_3611112","k127_13903044","k127_3611666","k127_15130953","k127_3612048","k127_2312508","k127_1458401","k127_7466767","k127_13905426","k127_15131472","k127_4477112","k127_5745780","k127_4048998","k127_3615442","k127_9174179","k127_13466587","k127_1877333","k127_4478548","k127_9617993","k127_12185411","k127_1462575","k127_11335968","k127_4480766","k127_155099","k127_12187128","k127_5749426","k127_12187506","k127_15133548","k127_13912037","k127_6174607","k127_5750828","k127_7058683","k127_2320215","k127_3173417","k127_12607396","k127_14371031","k127_4484884","k127_4901465","k127_5754086","k127_3175875","k127_7477202","k127_7909119","k127_159961","k127_12193268","k127_11777253","k127_602007","k127_1028736","k127_4903990","k127_9628099","k127_5328793","k127_2325808","k127_8341249","k127_12614892","k127_12614916","k127_11780415","k127_11345836","k127_1887702","k127_1031263","k127_4490021","k127_14801784","k127_164071","k127_10925245","k127_11348642","k127_4909754","k127_7917816","k127_5334941","k127_15139237","k127_2333030","k127_13929132","k127_2333519")
                    
Human_toRemove5<- c("k127_1477988","k127_9638805","k127_10515536","k127_612011","k127_3188219","k127_10073251","k127_13490028","k127_1038947","k127_7492625","k127_12208360","k127_15141011","k127_3638311","k127_9642157","k127_615658","k127_5341143","k127_15141671","k127_1482335","k127_3192693","k127_1899341","k127_176201","k127_12212246","k127_4502897","k127_2341148","k127_4079145","k127_13068555","k127_13069385","k127_178555","k127_179169","k127_4923374","k127_1486340","k127_11800100","k127_2767688","k127_2343571","k127_1903769","k127_11365666","k127_14402709","k127_8780454","k127_181587","k127_13073881","k127_1489832","k127_182874","k127_10948627","k127_7507424","k127_1910090","k127_11807831","k127_14411292","k127_6207275","k127_4090541","k127_5786516","k127_11375896","k127_14837742","k127_9217057","k127_4517131","k127_10956282","k127_13084818","k127_3658080","k127_15149486","k127_15149568","k127_15149637","k127_15149676","k127_3211844","k127_5791511","k127_6215448","k127_194006","k127_1918966","k127_4522754","k127_1501068","k127_15150892","k127_2784956","k127_12236596","k127_4941781","k127_13093098","k127_5366206","k127_13093597","k127_14850862","k127_10107815","k127_7112162","k127_1504499","k127_10108355","k127_11825006","k127_6666070","k127_3220770","k127_10551433","k127_13972901","k127_1926553","k127_6668290","k127_11828905","k127_5370892","k127_11828969","k127_13532086","k127_8805221","k127_1928687","k127_9231815","k127_8391121","k127_7962517","k127_13102147","k127_12665165","k127_4109192","k127_7119894","k127_7534918","k127_207240","k127_648136","k127_5376915","k127_7537801","k127_6230542","k127_15156567","k127_12251608","k127_14444853","k127_11838800","k127_3681046","k127_3234314","k127_4541904","k127_10565850","k127_15158270","k127_5381854","k127_1939457","k127_7974261","k127_654357","k127_10985880","k127_2379598","k127_4960987","k127_1941336","k127_10568959","k127_9693488","k127_9245498","k127_6238827","k127_6686173","k127_2806277","k127_14875733","k127_5815475","k127_1522415","k127_15159925","k127_11407849","k127_8408019","k127_1084165","k127_4548637","k127_6242967","k127_7139896","k127_660985","k127_4551677","k127_9699900","k127_3693722","k127_6244733","k127_1947980","k127_11413480","k127_11413694","k127_5821787","k127_4553149","k127_6246359","k127_13126873","k127_14884754","k127_9254966","k127_1090858","k127_665675","k127_1531847","k127_2391413","k127_14007062","k127_4975076","k127_3701988","k127_3702006","k127_7150164","k127_1536090","k127_4561317","k127_10587613","k127_670688","k127_671146","k127_11864647","k127_3705495","k127_3257541","k127_10149518","k127_9264762","k127_6257014","k127_3259586","k127_13573714","k127_14899102","k127_10151296","k127_10592310","k127_12700147","k127_7156647","k127_232230","k127_1540723","k127_2825793","k127_11428407","k127_1542498","k127_11429863","k127_14903927","k127_14905065","k127_7161784","k127_10597865","k127_2830083","k127_1545496","k127_14489603","k127_9724107","k127_4575820","k127_1970083","k127_14913095","k127_13152430","k127_15172404","k127_15172406","k127_6721184","k127_5846858","k127_5415682","k127_10607180","k127_1112248","k127_14917650","k127_10166382","k127_8856290","k127_1552771","k127_244135","k127_1553417","k127_13158535","k127_3278044","k127_11444770","k127_11446539","k127_14040963","k127_12304471","k127_13595545","k127_10172711","k127_5855194","k127_3282300","k127_8862838","k127_9288635","k127_11893052","k127_8451851","k127_14929973","k127_13600781","k127_1982588","k127_8454038","k127_5426911","k127_2847682","k127_3287289","k127_5427924","k127_15178151","k127_6737478","k127_5429551","k127_6739040","k127_11457507","k127_7187071","k127_7601635","k127_12317237","k127_4173487","k127_1128934","k127_1569102","k127_13609071","k127_5434364","k127_15180853","k127_5435118","k127_5435336")                    
 
Human_toRemove6 <- c("k127_9299998","k127_10189060","k127_2435351","k127_1571962","k127_15182011","k127_9302487","k127_6292078","k127_10191497","k127_8468505","k127_5019780","k127_7610452","k127_1135297","k127_13183477","k127_2861833","k127_1997293","k127_5441231","k127_15183991","k127_13618760","k127_9307583","k127_1138332","k127_6297779","k127_11474461","k127_713997","k127_2002256","k127_12750186","k127_7617932","k127_2446219","k127_2448067","k127_1145545","k127_5031938","k127_2872208","k127_720290","k127_8048730","k127_2449611","k127_13198058","k127_2873237","k127_276190","k127_13632600","k127_9769654","k127_4197540","k127_11486382","k127_9771916","k127_8487815","k127_1590192","k127_11077090","k127_8055179","k127_10215050","k127_7218410","k127_2457719","k127_3324824","k127_14090115","k127_9326575","k127_730734","k127_8059507","k127_8060151","k127_13643672","k127_11938866","k127_6778908","k127_7635908","k127_8062024","k127_2885274","k127_4630678","k127_6780509","k127_6780622","k127_3777918","k127_2021333","k127_12352474","k127_8063362","k127_1160364","k127_11498040","k127_8498989","k127_735425","k127_1599939","k127_1600222","k127_11088741","k127_5465461","k127_1600526","k127_3781910","k127_1163573","k127_291899","k127_3783240","k127_4214197","k127_10229195","k127_8068273","k127_13651728","k127_1165620","k127_7230173","k127_740537","k127_5906346","k127_8505900","k127_13653368","k127_8506581","k127_8915122","k127_2893609","k127_9790941","k127_9791094","k127_7647527","k127_4219676","k127_7648573","k127_2032802","k127_1608632","k127_12365761","k127_13226433","k127_13226852","k127_6332818","k127_5476457","k127_12368523","k127_13663267","k127_13664540","k127_5479101","k127_2477942","k127_1176807","k127_751367","k127_1615308","k127_12375910","k127_10688411","k127_1617241","k127_8086034","k127_755841","k127_5067551","k127_9806246","k127_1182587","k127_8087348","k127_3804512","k127_1618677","k127_5068773","k127_7660872","k127_2910038","k127_8525209","k127_757843","k127_2484376","k127_2044896","k127_312949","k127_5070680","k127_2487513","k127_316739","k127_11119567","k127_6348010","k127_317706","k127_13680549","k127_9361128","k127_1625744","k127_4240519","k127_13682392","k127_1626601","k127_1191640","k127_1627944","k127_10261847","k127_2920187","k127_8943896","k127_8537151","k127_8537510","k127_2922802","k127_3370235","k127_5498481","k127_8947603","k127_325008","k127_4672573","k127_6824741","k127_8949085","k127_326254","k127_2925316","k127_2925428","k127_2498921","k127_5500297","k127_1634769","k127_9372271","k127_3373318","k127_2499858","k127_6358564","k127_7267953","k127_8104869","k127_9825523","k127_13258513","k127_2928076","k127_3826390","k127_2501922","k127_6829224","k127_2929979","k127_12402819","k127_780686","k127_12820123","k127_9831247","k127_5091578","k127_8551709","k127_12820974","k127_3833197","k127_783007","k127_8112357","k127_5508447","k127_4258427","k127_1211046","k127_5094717","k127_3838357","k127_2074748","k127_5958394","k127_7694555","k127_6372650","k127_9388674","k127_6843318","k127_3389481","k127_3389900","k127_790969","k127_9390369","k127_5100954","k127_2519712","k127_1221227","k127_4697516","k127_2947906","k127_2948884","k127_3398430","k127_9398581","k127_6385147","k127_802716","k127_5525671","k127_1663018","k127_6386011","k127_355899","k127_1228614","k127_2955620","k127_3406154","k127_2528571","k127_6389593","k127_807185","k127_2529763","k127_6391153","k127_2530155","k127_1232635","k127_2532144","k127_2962232","k127_1675620","k127_5539153","k127_2105829","k127_1242592","k127_2969776","k127_1683391","k127_2971694","k127_2110407","k127_2974301","k127_1250046","k127_2113073","k127_2115259","k127_2115908","k127_2116283","k127_2117529","k127_2117578","k127_2118258","k127_5555537","k127_2983260","k127_2119892","k127_2554829","k127_2988252","k127_389457","k127_1267235","k127_1703802","k127_2129083","k127_2129461","k127_1270705","k127_1271746","k127_2130860","k127_1710396","k127_402433","k127_1279581","k127_404407","k127_1282079","k127_407385","k127_415721","k127_418415","k127_419699","k127_422700","k127_423639")      

JVIRAL<- subset_taxa(PHY2, (phylum %in% Human_toRemove) )
JVIRAL2<- subset_taxa(PHY2, (phylum %in% Human_toRemove2) )
JVIRAL3<- subset_taxa(PHY2, (phylum %in% Human_toRemove3) )
JVIRAL4<- subset_taxa(PHY2, (phylum %in% Human_toRemove4) )
JVIRAL5<- subset_taxa(PHY2, (phylum %in% Human_toRemove5) )
JVIRAL6<- subset_taxa(PHY2, (phylum %in% Human_toRemove6) )
JVIRAL_FINAL<- merge_phyloseq(JVIRAL,JVIRAL2,JVIRAL3,JVIRAL4,JVIRAL5,JVIRAL6)

```

```{r}
prevdf_ps= apply(X = otu_table(core_LH_rm), 
                       MARGIN = ifelse(taxa_are_rows(core_LH_rm), yes = 1, no = 2), 
                       FUN = function(x){sum(x > 0)})
prevdf_ps <- data.frame(Prevalence= prevdf_ps, TotalAbundance=taxa_sums(core_LH_rm))
#View(prevdf_ps)
ps_IBK_run <- rownames(prevdf_ps)[prevdf_ps$Prevalence > 1]
ps_IBK_run
ps_IBK_analyze <- prune_taxa(ps_IBK_run, core_LH_rm)
ps_IBK_analyze
sum(otu_table(ps_IBK_analyze))/sum(otu_table(core_LH_rm)) 
save(ps_IBK_analyze, file = "ps_IBK_analyze.rds")
load("ps_IBK_analyze.rds")
sum(otu_table(ps_IBK_analyze)) 
ps_rarefy <- rarefy_even_depth(ps_IBK_analyze, sample.size = min(sample_sums(ps_IBK_analyze)), rngseed = T, replace = TRUE, trimOTUs = TRUE, verbose = TRUE)

Chao1_obser_rarefy= estimate_richness(ps_rarefy, split = TRUE, measures = c("Chao1"))
head(Chao1_obser_rarefy)
obser_rarefy= estimate_richness(ps_rarefy, split = TRUE, measures = c("Observed"))
head(obser_rarefy)
shannon_obser_rarefy= estimate_richness(ps_rarefy, split = TRUE, measures = c("Shannon"))
Chao1_obser_rarefy_metadata= merge(META,Chao1_obser_rarefy, by= "row.names")
head(Chao1_obser_rarefy_metadata)
shannon_obser_rarefy_metadata= merge(META,shannon_obser_rarefy, by= "row.names")
```
```{r}
#run alpha diversity measures for Month_Sampled
alpha_meas = c("Observed", "Chao1", "Shannon")
(p <- plot_richness(ps_rarefy, "Subject", measures=alpha_meas))
test <- (p + geom_boxplot(data=p$data, aes(x=Subject, y=value, color=NULL), alpha=0.1)) 
plot(test)
observed_pairwise <- pairwise.wilcox.test(obser_rarefy$Observed, sample_data(ps_rarefy)$Subject)
observed_pairwise
#Significant differences: january&may, july&may, june&may, march&may
chao1_pairwise <- pairwise.wilcox.test(Chao1_obser_rarefy$Chao1, sample_data(ps_rarefy)$Subject)
chao1_pairwise 
#Significant differences: may&april, may&august, march&august, may&january, march&july, may&july, june&march, june&may, march&may, march&november, may&october, may&september, 
shannon_pairwise <- pairwise.wilcox.test(shannon_obser_rarefy$Shannon, sample_data(ps_rarefy)$Subject)
shannon_pairwise
#Significant differences: None. may not have worked though since all were 1
```
```
```{r}
norm_IBK  <-  transform_sample_counts(ps_IBK_analyze, function(x) x / sum(x) )
save(norm_IBK, file= "norm_IBK.rds")
load("norm_IBK.rds")
```
```

```{r}
ig <- make_network(PHY2, max.dist=0.6)
plot_network(ig, PHY2, color="Location", shape="Time_Collected", line_weight=0.4, label=NULL)
```
```{r}
#Core both hands
norm_hands_groups_test <- transform_sample_counts(core_hands_merge_test , function(x) x / sum(x) )
ord.hands_groups.pcoa_test <- ordinate(norm_hands_groups_test, method="PCoA", distance="bray")
plot_ordination(norm_hands_groups_test, ord.hands_groups.pcoa_test, color = "Subject", shape = "Time_Collected") +
  geom_point(size=1)
```

#BOO5
```{r}
B005<- subset_taxa(PHY2, Bin=="b005" )
#Core both hands
norm_B005 <- transform_sample_counts(B005 , function(x) x / sum(x) )
ord.B005 <- ordinate(norm_B005, method="PCoA", distance="bray")
plot_ordination(norm_B005, ord.B005, color = "Subject", shape = "Time_Collected") +
  geom_point(size=1)
metadata_B005 <- as(sample_data(norm_B005 ), "data.frame")
adonis(phyloseq::distance(norm_B005, method="bray") ~  Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject,
       data = metadata_B005)
```
```{r}
# Extract abundance matrix from the phyloseq object
Total_B005_OTU = as(otu_table(B005), "matrix")
# transpose if necessary
Total_B005_OTU <- t(Total_B005_OTU)
# Coerce to data.frame
Total_B005_OTUdf = as.data.frame(Total_B005_OTU)

#merge metadata file with alpha diversity measures:

#Remove samples from metadatafile that were removed from your phyloseq object (ie control samples, repeated samples, and other samples that are of other persons you are not using in this data set (P33, >P43))
Samples_toRemove <- c("HV_001_27", "HV_002_27", "HV_003_27", "HV_004_27", "HV_005_27", "HV_006_27", "HV_007_27", "HV_008_27",
                      "HV_009_27", "HV_010_27", "HV_011_27", "HV_012_27", "HV_013_27", "HV_014_27", "HV_015_27", "HV_016_27",
                      "HV_017_27", "HV_018_27", "HV_019_27", "HV_020_27", "HV_021_27", "HV_022_27", "HV_023_27", "HV_024_27",
                      "HV_025_27", "HV_026_27", "HV_027_27", "HV_028_27", "HV_029_27", "HV_030_27", "HV_015_20", "HV_015_21", 
                      "HV_020_22", "HV_027_02", "HV_027_03", "HV_027_04", "HV_027_05", "HV_027_06", "HV_027_07", "HV_020_10",
                      "HV_021_13", "HV_027_01")

B005_stat <- Metadata2[!grepl("HV_001_27", Metadata2$SampleID),]
B005_stat <- B005_stat[!grepl("HV_002_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_027_03", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_027_04", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_027_06", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_027_07", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_021_13", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_027_01", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_020_10", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_015_21", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_027_05", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_020_22", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_027_02", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_015_20", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_003_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_004_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_005_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_006_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_007_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_008_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_009_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_010_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_011_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_012_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_013_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_014_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_015_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_016_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_017_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_018_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_019_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_020_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_021_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_022_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_023_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_024_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_025_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_026_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_027_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_028_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_029_27", B005_stat$SampleID),]
B005_stat <- B005_stat[!grepl("HV_030_27", B005_stat$SampleID),]

#alpha diversity measures:
B005_stat$shannon.vegan <- diversity(Total_B005_OTUdf, index = "shannon")
B005_stat$simpson.vegan <- diversity(Total_B005_OTUdf, index = "simpson")
B005_stat$invsimpson.vegan <- diversity(Total_B005_OTUdf, index = "invsimpson")
```

#ANOVA of alpha diversity measures using shannon (can be repeated for simpson)
```{r}
model_B005_AOV <- aov(shannon.vegan~Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject, data = B005_stat)
summary(model_B005_AOV)
```
#B005_CORE
```{r}
B005_CORE<- subset_taxa(core_total_merge, Bin=="b005" )


B005_CORE_pruned <- prune_samples(sample_sums(B005_CORE) > 0, B005_CORE)
norm_B005_CORE <- transform_sample_counts(B005_CORE_pruned , function(x) x / sum(x) )

ord.B005_CORE <- ordinate(norm_B005_CORE, method="PCoA", distance="bray",na.rm = FALSE)
plot_ordination(norm_B005_CORE, ord.B005_CORE, color = "Subject", shape = "Time_Collected") +
  geom_point(size=1)
metadata_B005_CORE <- as(sample_data(norm_B005_CORE ), "data.frame")
adonis(phyloseq::distance(norm_B005_CORE, method="bray") ~  Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject,
       data = metadata_B005_CORE)
```

```{r}
# Extract abundance matrix from the phyloseq object
Total_B005_CORE_OTU = as(otu_table(B005_CORE), "matrix")
# transpose if necessary
Total_B005_CORE_OTU <- t(Total_B005_CORE_OTU)
# Coerce to data.frame
Total_B005_CORE_OTUdf = as.data.frame(Total_B005_CORE_OTU)

#merge metadata file with alpha diversity measures:

#Remove samples from metadatafile that were removed from your phyloseq object (ie control samples, repeated samples, and other samples that are of other persons you are not using in this data set (P33, >P43))
Samples_toRemove <- c("HV_001_27", "HV_002_27", "HV_003_27", "HV_004_27", "HV_005_27", "HV_006_27", "HV_007_27", "HV_008_27",
                      "HV_009_27", "HV_010_27", "HV_011_27", "HV_012_27", "HV_013_27", "HV_014_27", "HV_015_27", "HV_016_27",
                      "HV_017_27", "HV_018_27", "HV_019_27", "HV_020_27", "HV_021_27", "HV_022_27", "HV_023_27", "HV_024_27",
                      "HV_025_27", "HV_026_27", "HV_027_27", "HV_028_27", "HV_029_27", "HV_030_27", "HV_015_20", "HV_015_21", 
                      "HV_020_22", "HV_027_02", "HV_027_03", "HV_027_04", "HV_027_05", "HV_027_06", "HV_027_07", "HV_020_10",
                      "HV_021_13", "HV_027_01")

B005_CORE_stat <- Metadata2[!grepl("HV_001_27", Metadata2$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_002_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_027_03", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_027_04", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_027_06", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_027_07", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_021_13", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_027_01", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_020_10", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_015_21", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_027_05", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_020_22", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_027_02", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_015_20", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_003_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_004_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_005_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_006_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_007_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_008_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_009_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_010_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_011_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_012_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_013_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_014_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_015_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_016_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_017_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_018_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_019_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_020_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_021_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_022_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_023_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_024_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_025_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_026_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_027_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_028_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_029_27", B005_CORE_stat$SampleID),]
B005_CORE_stat <- B005_CORE_stat[!grepl("HV_030_27", B005_CORE_stat$SampleID),]

#alpha diversity measures:
B005_CORE_stat$shannon.vegan <- diversity(Total_B005_CORE_OTUdf, index = "shannon")
B005_CORE_stat$simpson.vegan <- diversity(Total_B005_CORE_OTUdf, index = "simpson")
B005_CORE_stat$invsimpson.vegan <- diversity(Total_B005_CORE_OTUdf, index = "invsimpson")
```

#ANOVA of alpha diversity measures using shannon (can be repeated for simpson)
```{r}
model_B005_CORE_AOV <- aov(shannon.vegan~Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject, data = B005_CORE_stat)
summary(model_B005_CORE_AOV)
```

#BOO5
```{r}
B055<- subset_taxa(PHY2, Bin=="b055" )
#Core both hands
norm_B055 <- transform_sample_counts(B055 , function(x) x / sum(x) )
ord.B055 <- ordinate(norm_B055, method="PCoA", distance="bray")
plot_ordination(norm_B055, ord.B055, color = "Subject", shape = "Time_Collected") +
  geom_point(size=1)
metadata_B055 <- as(sample_data(norm_B055 ), "data.frame")
adonis(phyloseq::distance(norm_B055, method="bray") ~  Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject,
       data = metadata_B055)
```
```{r}
# Extract abundance matrix from the phyloseq object
Total_B055_OTU = as(otu_table(B055), "matrix")
# transpose if necessary
Total_B055_OTU <- t(Total_B055_OTU)
# Coerce to data.frame
Total_B055_OTUdf = as.data.frame(Total_B055_OTU)

#merge metadata file with alpha diversity measures:

#Remove samples from metadatafile that were removed from your phyloseq object (ie control samples, repeated samples, and other samples that are of other persons you are not using in this data set (P33, >P43))
Samples_toRemove <- c("HV_001_27", "HV_002_27", "HV_003_27", "HV_004_27", "HV_005_27", "HV_006_27", "HV_007_27", "HV_008_27",
                      "HV_009_27", "HV_010_27", "HV_011_27", "HV_012_27", "HV_013_27", "HV_014_27", "HV_015_27", "HV_016_27",
                      "HV_017_27", "HV_018_27", "HV_019_27", "HV_020_27", "HV_021_27", "HV_022_27", "HV_023_27", "HV_024_27",
                      "HV_025_27", "HV_026_27", "HV_027_27", "HV_028_27", "HV_029_27", "HV_030_27", "HV_015_20", "HV_015_21", 
                      "HV_020_22", "HV_027_02", "HV_027_03", "HV_027_04", "HV_027_05", "HV_027_06", "HV_027_07", "HV_020_10",
                      "HV_021_13", "HV_027_01")

B055_stat <- Metadata2[!grepl("HV_001_27", Metadata2$SampleID),]
B055_stat <- B055_stat[!grepl("HV_002_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_027_03", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_027_04", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_027_06", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_027_07", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_021_13", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_027_01", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_020_10", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_015_21", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_027_05", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_020_22", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_027_02", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_015_20", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_003_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_004_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_005_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_006_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_007_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_008_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_009_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_010_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_011_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_012_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_013_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_014_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_015_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_016_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_017_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_018_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_019_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_020_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_021_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_022_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_023_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_024_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_025_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_026_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_027_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_028_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_029_27", B055_stat$SampleID),]
B055_stat <- B055_stat[!grepl("HV_030_27", B055_stat$SampleID),]

#alpha diversity measures:
B055_stat$shannon.vegan <- diversity(Total_B055_OTUdf, index = "shannon")
B055_stat$simpson.vegan <- diversity(Total_B055_OTUdf, index = "simpson")
B055_stat$invsimpson.vegan <- diversity(Total_B055_OTUdf, index = "invsimpson")
```
#B001
```{r}
B001<- subset_taxa(PHY2, Bin=="b001" )
norm_B001 <- transform_sample_counts(B001 , function(x) x / sum(x) )
ord.B001 <- ordinate(norm_B001, method="PCoA", distance="bray")
plot_ordination(norm_B001, ord.B001, color = "Subject", shape = "Time_Collected") +
  geom_point(size=1)
metadata_B001 <- as(sample_data(norm_B001 ), "data.frame")
adonis(phyloseq::distance(norm_B001, method="bray") ~  Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject,
       data = metadata_B001)
```
#B003
```{r}
B003<- subset_taxa(PHY2, Bin=="b003" )
norm_B003 <- transform_sample_counts(B003 , function(x) x / sum(x) )
ord.B003 <- ordinate(norm_B003, method="PCoA", distance="bray")
plot_ordination(norm_B003, ord.B003, color = "Subject", shape = "Time_Collected") +
  geom_point(size=1)
metadata_B003 <- as(sample_data(norm_B003 ), "data.frame")
adonis(phyloseq::distance(norm_B003, method="bray") ~  Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject,
       data = metadata_B003)
```
#B003_Hands_Only
```{r}
B003_LH<- subset_samples(B003, Location=="left" )
B003_RH<- subset_samples(B003, Location=="right" )
B003_hands <- merge_phyloseq(B003_LH, B003_RH) 
norm_B003_hands <- transform_sample_counts(B003_hands , function(x) x / sum(x) )
ord.B003_hands <- ordinate(norm_B003_hands, method="PCoA", distance="bray")
plot_ordination(norm_B003_hands, ord.B003_hands, color = "Subject", shape = "Time_Collected") +
  geom_point(size=1)
metadata_B003_hands <- as(sample_data(norm_B003_hands ), "data.frame")
adonis(phyloseq::distance(norm_B003_hands, method="bray") ~  Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject,
       data = metadata_B003_hands)

```


#B191
```{r}
B191<- subset_taxa(PHY2, Bin=="b191" )
norm_B191 <- transform_sample_counts(B191 , function(x) x / sum(x) )
ord.B191 <- ordinate(norm_B191, method="PCoA", distance="bray")
plot_ordination(norm_B191, ord.B191, color = "Subject", shape = "Time_Collected") +
  geom_point(size=1)
metadata_B191 <- as(sample_data(norm_B191 ), "data.frame")
adonis(phyloseq::distance(norm_B191, method="bray") ~  Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject,
       data = metadata_B191)
```

```{r}
B191_LH<- subset_samples(B191, Location=="left" )
B191_RH<- subset_samples(B191, Location=="right" )
B191_hands <- merge_phyloseq(B191_LH, B191_RH) 
norm_B191_hands <- transform_sample_counts(B191_hands , function(x) x / sum(x) )
ord.B191_hands <- ordinate(norm_B191_hands, method="PCoA", distance="bray")
plot_ordination(norm_B191_hands, ord.B191_hands, color = "Subject", shape = "Time_Collected") +
  geom_point(size=1)
metadata_B191_hands <- as(sample_data(norm_B191_hands ), "data.frame")
adonis(phyloseq::distance(norm_B191_hands, method="bray") ~  Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject,
       data = metadata_B191_hands)

```

```{r}

# Extract abundance matrix from the phyloseq object
Total_B191_OTU = as(otu_table(B191), "matrix")
# transpose if necessary
Total_B191_OTU <- t(Total_B191_OTU)
# Coerce to data.frame
Total_B191_OTUdf = as.data.frame(Total_B191_OTU)

#merge metadata file with alpha diversity measures:

#Remove samples from metadatafile that were removed from your phyloseq object (ie control samples, repeated samples, and other samples that are of other persons you are not using in this data set (P33, >P43))
Samples_toRemove <- c("HV_001_27", "HV_002_27", "HV_003_27", "HV_004_27", "HV_005_27", "HV_006_27", "HV_007_27", "HV_008_27",
                      "HV_009_27", "HV_010_27", "HV_011_27", "HV_012_27", "HV_013_27", "HV_014_27", "HV_015_27", "HV_016_27",
                      "HV_017_27", "HV_018_27", "HV_019_27", "HV_020_27", "HV_021_27", "HV_022_27", "HV_023_27", "HV_024_27",
                      "HV_025_27", "HV_026_27", "HV_027_27", "HV_028_27", "HV_029_27", "HV_030_27", "HV_015_20", "HV_015_21", 
                      "HV_020_22", "HV_027_02", "HV_027_03", "HV_027_04", "HV_027_05", "HV_027_06", "HV_027_07", "HV_020_10",
                      "HV_021_13", "HV_027_01")

B191_stat <- Metadata2[!grepl("HV_001_27", Metadata2$SampleID),]
B191_stat <- B191_stat[!grepl("HV_002_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_03", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_04", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_06", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_07", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_021_13", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_01", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_020_10", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_015_21", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_05", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_020_22", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_02", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_015_20", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_003_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_004_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_005_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_006_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_007_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_008_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_009_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_010_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_011_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_012_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_013_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_014_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_015_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_016_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_017_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_018_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_019_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_020_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_021_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_022_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_023_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_024_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_025_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_026_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_028_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_029_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_030_27", B191_stat$SampleID),]

#alpha diversity measures:
B191_stat$shannon.vegan <- diversity(Total_B191_OTUdf, index = "shannon")
B191_stat$simpson.vegan <- diversity(Total_B191_OTUdf, index = "simpson")
B191_stat$invsimpson.vegan <- diversity(Total_B191_OTUdf, index = "invsimpson")
```
```{r}
model_B191_AOV <- aov(shannon.vegan~Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject, data = B191_stat)
summary(model_B191_AOV)
```


```{r}

# Extract abundance matrix from the phyloseq object
Total_core_OTU = as(otu_table(PHY2), "matrix")
# transpose if necessary
Total_core_OTU <- t(Total_core_OTU)
# Coerce to data.frame
Total_core_OTUdf = as.data.frame(Total_core_OTU)

#merge metadata file with alpha diversity measures:

#Remove samples from metadatafile that were removed from your phyloseq object (ie control samples, repeated samples, and other samples that are of other persons you are not using in this data set (P33, >P43))
Samples_toRemove <- c("HV_001_27", "HV_002_27", "HV_003_27", "HV_004_27", "HV_005_27", "HV_006_27", "HV_007_27", "HV_008_27",
                      "HV_009_27", "HV_010_27", "HV_011_27", "HV_012_27", "HV_013_27", "HV_014_27", "HV_015_27", "HV_016_27",
                      "HV_017_27", "HV_018_27", "HV_019_27", "HV_020_27", "HV_021_27", "HV_022_27", "HV_023_27", "HV_024_27",
                      "HV_025_27", "HV_026_27", "HV_027_27", "HV_028_27", "HV_029_27", "HV_030_27", "HV_015_20", "HV_015_21", 
                      "HV_020_22", "HV_027_02", "HV_027_03", "HV_027_04", "HV_027_05", "HV_027_06", "HV_027_07", "HV_020_10",
                      "HV_021_13", "HV_027_01")

Metadata_core_stat <- Metadata2[!grepl("HV_001_27", Metadata2$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_002_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_027_03", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_027_04", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_027_06", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_027_07", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_021_13", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_027_01", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_020_10", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_015_21", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_027_05", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_020_22", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_027_02", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_015_20", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_003_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_004_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_005_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_006_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_007_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_008_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_009_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_010_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_011_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_012_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_013_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_014_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_015_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_016_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_017_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_018_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_019_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_020_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_021_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_022_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_023_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_024_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_025_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_026_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_027_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_028_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_029_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("HV_030_27", Metadata_core_stat$SampleID),]
Metadata_core_stat <- Metadata_core_stat[!grepl("left", Metadata_core_stat$Location),]
Metadata_core_stat <- Metadata_core_stat[!grepl("scalp", Metadata_core_stat$Location),]
#alpha diversity measures:

#alpha diversity measures:
Metadata_core_stat$shannon.vegan <- diversity(Total_core_OTUdf, index = "shannon")
Metadata_core_stat$simpson.vegan <- diversity(Total_core_OTUdf, index = "simpson")
Metadata_core_stat$invsimpson.vegan <- diversity(Total_core_OTUdf, index = "invsimpson")
```

#ANOVA of alpha diversity measures using shannon (can be repeated for simpson)
```{r}
model_core_AOV <- aov(shannon.vegan~Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject, data = Metadata_core_stat)
summary(model_core_AOV)
```

```{r}
B191_LH<- subset_samples(PHY2, Location=="left" )
B191_RH<- subset_samples(PHY2, Location=="right" )
B191_hands <- merge_phyloseq(B191_LH, B191_RH) 
norm_B191_hands <- transform_sample_counts(B191_hands , function(x) x / sum(x) )
ord.B191_hands <- ordinate(norm_B191_hands, method="PCoA", distance="bray")
plot_ordination(norm_B191_hands, ord.B191_hands, color = "Subject", shape = "Time_Collected") +
  geom_point(size=1)
metadata_B191_hands <- as(sample_data(norm_B191_hands ), "data.frame")
adonis(phyloseq::distance(norm_B191_hands, method="bray") ~  Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject,
       data = metadata_B191_hands)

```

```{r}

# Extract abundance matrix from the phyloseq object
Total_B191_OTU = as(otu_table(B191_hands), "matrix")
# transpose if necessary
Total_B191_OTU <- t(Total_B191_OTU)
# Coerce to data.frame
Total_B191_OTUdf = as.data.frame(Total_B191_OTU)

#merge metadata file with alpha diversity measures:

#Remove samples from metadatafile that were removed from your phyloseq object (ie control samples, repeated samples, and other samples that are of other persons you are not using in this data set (P33, >P43))
Samples_toRemove <- c("HV_001_27", "HV_002_27", "HV_003_27", "HV_004_27", "HV_005_27", "HV_006_27", "HV_007_27", "HV_008_27",
                      "HV_009_27", "HV_010_27", "HV_011_27", "HV_012_27", "HV_013_27", "HV_014_27", "HV_015_27", "HV_016_27",
                      "HV_017_27", "HV_018_27", "HV_019_27", "HV_020_27", "HV_021_27", "HV_022_27", "HV_023_27", "HV_024_27",
                      "HV_025_27", "HV_026_27", "HV_027_27", "HV_028_27", "HV_029_27", "HV_030_27", "HV_015_20", "HV_015_21", 
                      "HV_020_22", "HV_027_02", "HV_027_03", "HV_027_04", "HV_027_05", "HV_027_06", "HV_027_07", "HV_020_10",
                      "HV_021_13", "HV_027_01")

B191_stat <- Metadata2[!grepl("HV_001_27", Metadata2$SampleID),]
B191_stat <- B191_stat[!grepl("HV_002_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_03", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_04", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_06", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_07", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_021_13", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_01", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_020_10", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_015_21", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_05", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_020_22", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_02", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_015_20", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_003_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_004_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_005_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_006_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_007_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_008_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_009_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_010_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_011_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_012_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_013_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_014_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_015_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_016_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_017_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_018_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_019_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_020_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_021_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_022_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_023_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_024_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_025_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_026_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_027_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_028_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_029_27", B191_stat$SampleID),]
B191_stat <- B191_stat[!grepl("HV_030_27", B191_stat$SampleID),]

#alpha diversity measures:
B191_stat$shannon.vegan <- diversity(Total_B191_OTUdf, index = "shannon")
B191_stat$simpson.vegan <- diversity(Total_B191_OTUdf, index = "simpson")
B191_stat$invsimpson.vegan <- diversity(Total_B191_OTUdf, index = "invsimpson")
```
```{r}
model_B191_AOV <- aov(shannon.vegan~Location+Gender+Time_Week+Subject/Location+ Subject/Time_Week+Subject, data = B191_stat)
summary(model_B191_AOV)
```








p2<-ggtree(tree2, branch.length='none') +  geom_tiplab()
p3<-p2 + new_scale_fill() +
         geom_fruit(data=dat2A, geom=geom_bar,
                    mapping=aes(y=label, x=Abundance, fill=Subject),
                    pwidth=0.38, 
                    orientation="y", 
                    stat="identity",
                    offset = 0.13,
                    axis.params = "x"
         ) +
        scale_fill_igv(palette = c("default"),
                           guide=guide_legend(keywidth = 0.3, keyheight = 0.3, order=4))+
         geom_treescale(fontsize=2, linesize=0.3, x=4.9, y=0.1) +
         theme(legend.position=c(0.93, 0.5),
               legend.background=element_rect(fill=NA),
               legend.title=element_text(size=6.5),
               legend.text=element_text(size=4.5),
               legend.spacing.y = unit(0.02, "cm"),
             )

p3 + layout_rectangular() + 
    theme(legend.position=c(.05, .7))